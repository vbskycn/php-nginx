# 项目指南

## 贡献指南

我很喜欢您的参与！我想让为这个项目做贡献变得尽可能简单和透明。

### 使用GitHub的[问题](https://github.com/vbskycn/php-nginx/issues)报告错误

GitHub问题用于跟踪公共错误。
通过[创建新问题](https://github.com/vbskycn/php-nginx/issues/new)来报告错误；就这么简单！

#### 在问题中应该包含什么？

- 快速摘要和/或背景
- 重现步骤
  - 包含您使用的镜像版本
  - 如果您进行了任何更改，请添加`Dockerfile`
  - 包含您用于运行容器的命令
- 您期望会发生什么
- 实际发生了什么
- 备注（可能包括您认为这可能是为什么发生的原因，或者您尝试过但没有效果的内容）

### 许可证

通过贡献，您同意您的贡献将根据其[MIT许可证](../LICENSE)进行许可。

## 安全策略

### 支持的版本

只有最新版本将得到支持并接收安全更新。

| 版本 | 支持状态 |
| ------- | ------------------ |
| 3.x.x   | :white_check_mark: |
| 2.x.x   | :x:                |
| 1.x.x   | :x:                |

### 报告漏洞

发现了潜在的漏洞？请通过邮件 zhoujie218@gmail.com 报告。

## 开发指南

### 本地开发

1. 克隆仓库
```bash
git clone https://github.com/vbskycn/php-nginx.git
cd php-nginx
```

2. 构建镜像
```bash
docker build -t php-nginx:dev .
```

3. 运行测试
```bash
docker compose -f docker-compose.test.yml up
```

### 版本管理

项目使用 `version` 文件来管理版本号：
- 格式：`php-nginx:版本号`
- 示例：`php-nginx:1.1.47`

更新版本时：
1. 修改 `version` 文件
2. 提交并推送到 main 分支
3. 自动触发构建和发布

### 代码规范

- 遵循 Docker 最佳实践
- 保持 Dockerfile 简洁高效
- 使用多阶段构建优化镜像大小
- 确保安全性（非root用户运行）
- 环境变量配置使用模板化方式
- 配置文件使用 `.template` 后缀
- 配置脚本使用 `envsubst` 进行变量替换
- 所有配置都有合理的默认值

### 环境变量配置开发

#### 添加新的环境变量
1. 在 `configure.sh` 中添加默认值设置
2. 在相应的配置模板中添加变量占位符
3. 更新文档说明新变量的用途和推荐值
4. 在测试中验证新配置的正确性

#### 配置模板规范
- 使用 `${VARIABLE_NAME}` 格式
- 确保模板文件语法正确
- 添加必要的注释说明
- 保持配置文件的简洁性

#### 测试要求
- 验证所有环境变量的默认值
- 测试配置生成和验证流程
- 确保服务能正常启动
- 验证配置变更的效果
